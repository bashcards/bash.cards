#!/usr/bin/env bash
Y='\033[33m';Z='\033[0m';exec </dev/tty >/dev/tty 2>&1;pause(){ read -r _;};hdr(){ clear;echo -e "${Y}+----------------------------------+";echo "|       KING OF CARCOSA â€“ SSH      |";echo "+----------------------------------+";echo -e "${Y}$1${Z}";};main(){ while :;do hdr "Main Menu";echo -e "${Y}1) Client: SSH client tools${Z}";echo -e "${Y}2) Server: SSH service controls${Z}";echo -e "${Y}3) Tunnels: Port/SOCKS helpers${Z}";echo -e "${Y}4) System: Host & SSH info${Z}";echo -e "${Y}5) Exit${Z}";printf "> ";read -r R;case $R in 1)client;;2)server;;3)tunnels;;4)system;;5)exit;;*)echo "?";pause;;esac;done;};client(){ while :;do hdr "Client Tools";echo -e "${Y}1) Edit SSH config (~/.ssh/config)${Z}";echo -e "${Y}2) View SSH config${Z}";echo -e "${Y}3) Generate SSH key${Z}";echo -e "${Y}4) Add key to ssh-agent${Z}";echo -e "${Y}5) Test connection (user@host)${Z}";echo -e "${Y}6) Back${Z}";printf "> ";read -r R;case $R in 1)f="$HOME/.ssh/config";[ -f $f ]||{ mkdir -p "$HOME/.ssh";:>"$f";};"${EDITOR:-nano}" "$f";;2)f="$HOME/.ssh/config";[ -f $f ]&&cat "$f"||echo none;pause;;3)read -rp "Key type [rsa/ed25519]: " t;t=${t:-ed25519};read -rp "RSA bits [4096]: " b;b=${b:-4096};read -rp "Key file name [id_$t]: " k;k=${k:-id_$t};[ $t = rsa ]&&ssh-keygen -t rsa -b $b -f "$HOME/.ssh/$k"||ssh-keygen -t ed25519 -f "$HOME/.ssh/$k";pause;;4)ssh-add -l>/dev/null 2>&1||eval "$(ssh-agent -s)";read -rp "Private key filename [id_rsa]: " k;k=${k:-id_rsa};ssh-add "$HOME/.ssh/$k"&&echo ok||echo fail;pause;;5)read -rp "Target (user@host): " h;ssh -q -o BatchMode=yes -o ConnectTimeout=5 "$h" exit&&echo ok||echo fail;pause;;6)return;;*)echo "?";pause;;esac;done;};server(){ while :;do hdr "Server Controls";echo -e "${Y}1) Start SSH service${Z}";echo -e "${Y}2) Stop SSH service${Z}";echo -e "${Y}3) Restart SSH service${Z}";echo -e "${Y}4) Show SSH service status${Z}";echo -e "${Y}5) Back${Z}";printf "> ";read -r R;case $R in 1)for u in ssh sshd;do sudo systemctl start $u 2>/dev/null&&break;done||sudo service ssh start;pause;;2)for u in ssh sshd;do sudo systemctl stop $u 2>/dev/null&&break;done||sudo service ssh stop;pause;;3)for u in ssh sshd;do sudo systemctl restart $u 2>/dev/null&&break;done||sudo service ssh restart;pause;;4)systemctl --no-pager -l status ssh 2>/dev/null||systemctl --no-pager -l status sshd 2>/dev/null||sudo service ssh status;pause;;5)return;;*)echo "?";pause;;esac;done;};tunnels(){ while :;do hdr "Tunnels";echo -e "${Y}1) Local port forward (L)${Z}";echo -e "${Y}2) Remote port forward (R)${Z}";echo -e "${Y}3) SOCKS proxy (D)${Z}";echo -e "${Y}4) List active SSH tunnels${Z}";echo -e "${Y}5) Kill tunnel by PID${Z}";echo -e "${Y}6) Back${Z}";printf "> ";read -r R;case $R in 1)read -rp "Local port: " lp;read -rp "Remote host: " rh;read -rp "Remote port: " rp;read -rp "SSH target (user@host): " s0;ssh -L "$lp:$rh:$rp" "$s0" -N & pause;;2)read -rp "Remote port: " rp;read -rp "Local host: " lh;read -rp "Local port: " lp;read -rp "SSH target (user@host): " s0;ssh -R "$rp:$lh:$lp" "$s0" -N & pause;;3)read -rp "SOCKS port [1080]: " d;d=${d:-1080};read -rp "SSH target (user@host): " s0;ssh -D "$d" "$s0" -N & pause;;4)ps -eo pid,ppid,command|awk '/ssh.*-[LRD]/{print}';pause;;5)ps -eo pid,ppid,command|awk '/ssh.*-[LRD]/{print}';read -rp "PID to kill: " q;kill $q&&echo ok||echo fail;pause;;6)return;;*)echo "?";pause;;esac;done;};system(){ hdr "System Info";echo -e "${Y}Host: $(hostname)${Z}";echo -e "${Y}OS: $(uname -s)${Z}";echo -e "${Y}Kernel: $(uname -r)${Z}";echo -e "${Y}Arch: $(uname -m)${Z}";echo -e "${Y}User: $(whoami)${Z}";echo -e "${Y}SSH Port: $(awk '/^Port/{print $2}' /etc/ssh/sshd_config 2>/dev/null||echo 22)${Z}";pause;};main
